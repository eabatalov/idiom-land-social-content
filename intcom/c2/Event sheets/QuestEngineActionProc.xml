<?xml version="1.0" encoding="utf-8" ?>
<c2eventsheet>
    <!--All the 'name' attributes are ignored by Construct 2 - they are there for readability only.-->
    <name>QuestEngineActionProc</name>
    <events>
        <event-group description="" sid="3100647790949735" title="Quest action processing">
            <sub-events>
                <event-group description="" sid="8412942542802775" title="Quest actions IN">
                    <sub-events>
                        <variable constant="0" name="BlockUIActionInCount" sid="3661459468619402" static="1" type="number">0</variable>
                        <event-block sid="6080743863123612">
                            <conditions>
                                <condition id="0" name="On function" sid="6829095642633925" type="Function">
                                    <param id="0" name="Name">&quot;VarsReset&quot;</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="7405466653452598">
                                    <conditions />
                                    <actions>
                                        <action id="-9" name="Set value" sid="3597928934496965" type="System">
                                            <param id="0" name="Variable">BlockUIActionInCount</param>
                                            <param id="1" name="Value">0</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-group description="" sid="617509718409851" title="Quest actions IN interface">
                            <sub-events>
                                <event-block sid="3666487095470993">
                                    <conditions>
                                        <condition id="0" name="On function" sid="4218672536757897" type="Function">
                                            <param id="0" name="Name">&quot;LockUIActionsINProcessing&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <event-block sid="4462375874179796">
                                            <conditions />
                                            <actions>
                                                <action id="-9" name="Set value" sid="3264800309476903" type="System">
                                                    <param id="0" name="Variable">BlockUIActionInCount</param>
                                                    <param id="1" name="Value">BlockUIActionInCount + 1</param>
                                                </action>
                                                <action disabled="1" id="14" name="Log" sid="7550428085722546" type="Browser">
                                                    <param id="0" name="Type">0</param>
                                                    <param id="1" name="Message">&quot;LOCKED: &quot; &amp; Function.Param(0)</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <event-block sid="2181479984983191">
                                    <conditions>
                                        <condition id="0" name="On function" sid="7804790539123348" type="Function">
                                            <param id="0" name="Name">&quot;UnlockUIActionsINProcessing&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <event-block sid="7309090994754062">
                                            <conditions />
                                            <actions>
                                                <action id="-9" name="Set value" sid="5786381721224031" type="System">
                                                    <param id="0" name="Variable">BlockUIActionInCount</param>
                                                    <param id="1" name="Value">BlockUIActionInCount - 1</param>
                                                </action>
                                                <action disabled="1" id="14" name="Log" sid="5539085498783193" type="Browser">
                                                    <param id="0" name="Type">0</param>
                                                    <param id="1" name="Message">&quot;ULOCKED: &quot; &amp; Function.Param(0)</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <comment>Process Quest Engine action immediately if possible. Otherwise drop it.&#x0D;&#x0A;p0: qe action type&#x0D;&#x0A;p1: qe action &apos;target id&apos; data&#x0D;&#x0A;p2: qe action &apos;name&apos; data</comment>
                                <event-block sid="6320937471953349">
                                    <conditions>
                                        <condition id="0" name="On function" sid="3255362980692853" type="Function">
                                            <param id="0" name="Name">&quot;QEProcUIAction&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <event-block sid="873263667348898">
                                            <conditions>
                                                <condition id="-8" name="Compare two values" sid="1509804260415189" type="System">
                                                    <param id="0" name="First value">BlockUIActionInCount</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Second value">0</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="0" name="Call function" sid="4317453905005769" type="Function">
                                                    <param id="0" name="Name">&quot;QEEnqueueUIAction&quot;</param>
                                                    <param id="1" name="Parameter {n}">Function.Param(0){###}Function.Param(1){###}Function.Param(2)</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                        <event-block sid="3175915388979934">
                                            <conditions>
                                                <condition id="-22" name="Else" sid="8488239551495012" type="System" />
                                            </conditions>
                                            <actions>
                                                <action id="14" name="Log" sid="3891619979481127" type="Browser">
                                                    <param id="0" name="Type">1</param>
                                                    <param id="1" name="Message">&quot;Player action of type &quot; &amp; Function.Param(0) &amp; &quot; with target &quot; &amp; Function.Param(1) &amp; &quot; is blocked&quot;</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <comment>Process Quest Engine action immediately if possible. Otherwise postpone it.&#x0D;&#x0A;p0: qe action type&#x0D;&#x0A;p1: qe action &apos;target id&apos; data&#x0D;&#x0A;p2: qe action &apos;name&apos; data</comment>
                                <event-block sid="1359721088397747">
                                    <conditions>
                                        <condition id="0" name="On function" sid="549117859264555" type="Function">
                                            <param id="0" name="Name">&quot;QEEnqueueUIAction&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <event-block sid="1825990987905024">
                                            <conditions />
                                            <actions>
                                                <action id="0" name="Call function" sid="6074100552796629" type="Function">
                                                    <param id="0" name="Name">&quot;LockUIActionsINProcessing&quot;</param>
                                                    <param id="1" name="Parameter {n}">&quot;ProcUIActionIN&quot;</param>
                                                </action>
                                                <action id="0" name="Call function" sid="2918593271746394" type="Function">
                                                    <param id="0" name="Name">&quot;onBeforeQuestActionInProc&quot;</param>
                                                    <param id="1" name="Parameter {n}"></param>
                                                </action>
                                                <action id="4" name="Set current stage" sid="9168260037996853" type="QuestLevelRuntime">
                                                    <param id="0" name="Value">CurrentStageName</param>
                                                </action>
                                                <action id="5" name="Set last player action" sid="5097253692288162" type="QuestLevelRuntime">
                                                    <param id="0" name="Last action">Function.Param(0)</param>
                                                </action>
                                                <action id="6" name="Set last action target id" sid="3582665451453215" type="QuestLevelRuntime">
                                                    <param id="0" name="Value">Function.Param(1)</param>
                                                </action>
                                                <action id="7" name="Set last action &apos;name&apos; value" sid="4107819312138807" type="QuestLevelRuntime">
                                                    <param id="0" name="Value">Function.Param(2)</param>
                                                </action>
                                                <action id="1" name="Execute last player action on current stage" sid="8413799453876062" type="QuestLevelRuntime" />
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                            </sub-events>
                        </event-group>
                    </sub-events>
                </event-group>
                <event-group description="" sid="1619281223884339" title="Quest actions OUT">
                    <sub-events>
                        <variable constant="0" name="CurrentUICmdName" sid="7528182529661732" static="1" type="text"></variable>
                        <event-block sid="9082145856582282">
                            <conditions>
                                <condition id="0" name="On function" sid="958051817938376" type="Function">
                                    <param id="0" name="Name">&quot;VarsReset&quot;</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Set value" sid="5946587902018202" type="System">
                                    <param id="0" name="Variable">CurrentUICmdName</param>
                                    <param id="1" name="Value">&quot;&quot;</param>
                                </action>
                            </actions>
                        </event-block>
                        <comment>XXX theoretically our UI &lt;=&gt; protocol allows to send UI action to any stage. but in practice it is impossible due to&#x0D;&#x0A;- Solid stage changers during UI action execution&#x0D;&#x0A;We set here CurrentStage to work ok during gameplay playback because stage changers may not trigger intersection with player that is moving by 1 sec position measurements.</comment>
                        <comment>param(0): UI cmd name</comment>
                        <event-block sid="5481348960594246">
                            <conditions>
                                <condition id="0" name="On function" sid="1042399759140915" type="Function">
                                    <param id="0" name="Name">&quot;onBeforeQuestUICmdProcessing&quot;</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="5474654595090607">
                                    <conditions />
                                    <actions>
                                        <action id="-9" name="Set value" sid="3795661995045002" type="System">
                                            <param id="0" name="Variable">CurrentUICmdName</param>
                                            <param id="1" name="Value">Function.Param(0)</param>
                                        </action>
                                        <action id="0" name="Call function" sid="6876093602140393" type="Function">
                                            <param id="0" name="Name">&quot;QuestEngineChangeStage&quot;</param>
                                            <param id="1" name="Parameter {n}">QuestLevelRuntime.getCurrentStage</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="8571200903386115">
                            <conditions>
                                <condition id="0" name="On function" sid="2753930785321523" type="Function">
                                    <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="3475416915539406">
                                    <conditions />
                                    <actions>
                                        <action id="-9" name="Set value" sid="2483869191072999" type="System">
                                            <param id="0" name="Variable">CurrentUICmdName</param>
                                            <param id="1" name="Value">&quot;&quot;</param>
                                        </action>
                                        <action id="8" name="UICmdCompleted" sid="9589206179918434" type="QuestLevelRuntime" />
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="927682085434178">
                            <conditions>
                                <condition id="1" name="onUICmdSequenceStarted" sid="518107799913528" type="QuestLevelRuntime" />
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="67592591778122">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="2630717560159204" type="Function">
                                            <param id="0" name="Name">&quot;onBeforeQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}">&quot;UI_CMD_SEQUENCE_STARTED&quot;</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <comment>UI logic</comment>
                                <event-block sid="1017644569005597">
                                    <conditions>
                                        <condition id="-8" name="Compare two values" sid="1611273537752378" type="System">
                                            <param id="0" name="First value">QuestLevelRuntime.getClearStage</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Second value">1</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="3945008245356997" type="Function">
                                            <param id="0" name="Name">&quot;HideStageUI&quot;</param>
                                            <param id="1" name="Parameter {n}">CurrentStageName{###}1</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <event-block sid="2080060583289271">
                                    <conditions>
                                        <condition id="-22" name="Else" sid="2432006475248681" type="System" />
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="53667271149639" type="Function">
                                            <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="63557050990842">
                            <conditions>
                                <condition id="0" name="On function" sid="2188694999171904" type="Function">
                                    <param id="0" name="Name">&quot;onDialogHidden&quot;</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="5005245809449544">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="3626748737867485" type="System">
                                            <param id="0" name="Variable">CurrentUICmdName</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">&quot;UI_CMD_SEQUENCE_STARTED&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="5253549056769645" type="Function">
                                            <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="1025008497966056">
                            <conditions>
                                <condition id="2" name="onUICmdSequenceFinished" sid="2522677337676264" type="QuestLevelRuntime" />
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="4413154926201069">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="5402584328597654" type="Function">
                                            <param id="0" name="Name">&quot;ProcEndOfUICmdSequence&quot;</param>
                                            <param id="1" name="Parameter {n}">&quot;UI_CMD_SEQUENCE_FINISHED&quot;</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="1314048152235586">
                            <conditions>
                                <condition id="10" name="onNoUIActionRequired" sid="8474655224572932" type="QuestLevelRuntime" />
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="5767724087035366">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="4228403035599813" type="Function">
                                            <param id="0" name="Name">&quot;ProcEndOfUICmdSequence&quot;</param>
                                            <param id="1" name="Parameter {n}">&quot;NO_UI_ACTION_REQUIRED&quot;</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="789221393072072">
                            <conditions>
                                <condition id="0" name="On function" sid="3233118025932086" type="Function">
                                    <param id="0" name="Name">&quot;ProcEndOfUICmdSequence&quot;</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="3938140196698725">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="9804936707980947" type="Function">
                                            <param id="0" name="Name">&quot;onBeforeQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}">Function.Param(0)</param>
                                        </action>
                                        <action id="0" name="Call function" sid="2891094696793049" type="Function">
                                            <param id="0" name="Name">&quot;UnlockUIActionsINProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}">Function.Param(0)</param>
                                        </action>
                                        <action id="0" name="Call function" sid="2470263615283569" type="Function">
                                            <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                        <action id="0" name="Call function" sid="8453219625987824" type="Function">
                                            <param id="0" name="Name">&quot;onAfterUICmdSeqProc&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="3147135058549519">
                            <conditions>
                                <condition id="9" name="onUICmdAnimation" sid="285822531105772" type="QuestLevelRuntime" />
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="7640483504479411">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="7055482923622774" type="Function">
                                            <param id="0" name="Name">&quot;onBeforeQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}">&quot;ANIMATION&quot;</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <event-block sid="1386478991747945">
                                    <conditions>
                                        <condition id="-8" name="Compare two values" sid="5508708337010133" type="System">
                                            <param id="0" name="First value">QuestLevelRuntime.getDuration</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Second value">-1</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="433612551919166" type="Function">
                                            <param id="0" name="Name">&quot;NPCAnim&quot;</param>
                                            <param id="1" name="Parameter {n}">QuestLevelRuntime.getNPCActorUID{###}QuestLevelRuntime.getAnimationName</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <event-block sid="6802718497884443">
                                    <conditions>
                                        <condition id="-22" name="Else" sid="4815834574080703" type="System" />
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="1648811919064653" type="Function">
                                            <param id="0" name="Name">&quot;NPCAnimTimed&quot;</param>
                                            <param id="1" name="Parameter {n}">QuestLevelRuntime.getNPCActorUID{###}QuestLevelRuntime.getAnimationName{###}QuestLevelRuntime.getDuration*1000</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <event-block sid="6060973388832646">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="2648539473202614" type="Function">
                                            <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="6804841689146283">
                            <conditions>
                                <condition id="5" name="onUICmdNotification" sid="6433324461538964" type="QuestLevelRuntime" />
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="3529577585797845">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="6521140847773083" type="Function">
                                            <param id="0" name="Name">&quot;onBeforeQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}">&quot;NOTIFICATION&quot;</param>
                                        </action>
                                        <action id="0" name="Call function" sid="7777318774965925" type="Function">
                                            <param id="0" name="Name">&quot;RunNotification&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="4198154170041237">
                            <conditions>
                                <condition id="0" name="On function" sid="4177421200139092" type="Function">
                                    <param id="0" name="Name">&quot;onRunNotificationFinished&quot;</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="9348351526917531">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="8818397514026662" type="System">
                                            <param id="0" name="Variable">CurrentUICmdName</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">&quot;NOTIFICATION&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="4617195193466903" type="Function">
                                            <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="755402608018249">
                            <conditions>
                                <condition id="6" name="onUICmdPlayerMovement" sid="1792312785682696" type="QuestLevelRuntime" />
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="490064598733704">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="7244449206299129" type="Function">
                                            <param id="0" name="Name">&quot;onBeforeQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}">&quot;PLAYER_MOVEMENT&quot;</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <comment>No need to implement in comic</comment>
                                <event-block sid="1120875118047533">
                                    <conditions>
                                        <condition id="-8" name="Compare two values" sid="1615309781218767" type="System">
                                            <param id="0" name="First value">QuestLevelRuntime.getEnabled</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Second value">0</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                </event-block>
                                <event-block sid="9504258035571288">
                                    <conditions>
                                        <condition id="-22" name="Else" sid="1955879110594609" type="System" />
                                        <condition id="-8" name="Compare two values" sid="9541814556224911" type="System">
                                            <param id="0" name="First value">QuestLevelRuntime.getEnabled</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Second value">1</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                </event-block>
                                <event-block sid="296407252316279">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="7004044399523475" type="Function">
                                            <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="4600813701107499">
                            <conditions>
                                <condition id="3" name="onUICmdStageClear" sid="5529100445023852" type="QuestLevelRuntime" />
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="580459388820525">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="9376959230817075" type="Function">
                                            <param id="0" name="Name">&quot;onBeforeQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}">&quot;STAGE_CLEAR&quot;</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <event-block sid="444328219702671">
                                    <conditions>
                                        <condition id="-8" name="Compare two values" sid="9768702915786183" type="System">
                                            <param id="0" name="First value">QuestLevelRuntime.getAllowAnimated</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Second value">0</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="2070825166037213" type="Function">
                                            <param id="0" name="Name">&quot;HideStageUI&quot;</param>
                                            <param id="1" name="Parameter {n}">QuestLevelRuntime.getCurrentStage{###}0</param>
                                        </action>
                                        <action id="0" name="Call function" sid="2764132489347324" type="Function">
                                            <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                                <event-block sid="7720176007723205">
                                    <conditions>
                                        <condition id="-22" name="Else" sid="9153711783925562" type="System" />
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="136429618421351" type="Function">
                                            <param id="0" name="Name">&quot;HideStageUI&quot;</param>
                                            <param id="1" name="Parameter {n}">QuestLevelRuntime.getCurrentStage{###}1</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="6755658360533558">
                            <conditions>
                                <condition id="0" name="On function" sid="5835526191626291" type="Function">
                                    <param id="0" name="Name">&quot;onDialogHidden&quot;</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="2376191190793468">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="6323506954818136" type="System">
                                            <param id="0" name="Variable">CurrentUICmdName</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">&quot;STAGE_CLEAR&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="4204716621963858" type="Function">
                                            <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-group description="" sid="2970242295948781" title="UI cmd function call">
                            <sub-events>
                                <comment>NONE | PENDING</comment>
                                <variable constant="0" name="FunctionCallWaitState" sid="9359767391288267" static="1" type="number">0</variable>
                                <variable constant="1" name="FUNCTION_CALL_STATE_NONE" sid="3737250160086304" static="1" type="number">1</variable>
                                <variable constant="1" name="FUNCTION_CALL_STATE_COMPLETION_PENDING" sid="3448301898444895" static="1" type="number">2</variable>
                                <event-block sid="5205894478729172">
                                    <conditions>
                                        <condition id="0" name="On function" sid="7921958315916434" type="Function">
                                            <param id="0" name="Name">&quot;VarsReset&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <event-block sid="6242658382839192">
                                            <conditions />
                                            <actions>
                                                <action id="-9" name="Set value" sid="3806701347492522" type="System">
                                                    <param id="0" name="Variable">FunctionCallWaitState</param>
                                                    <param id="1" name="Value">FUNCTION_CALL_STATE_NONE</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <event-block sid="4808982679532209">
                                    <conditions>
                                        <condition id="4" name="onUICmdFuncCall" sid="7293651486461447" type="QuestLevelRuntime" />
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <comment>XXX we should stop using set return value here (out of function) because behavior of this action is undefined.</comment>
                                        <event-block sid="9864808444785909">
                                            <conditions />
                                            <actions>
                                                <action id="-9" name="Set value" sid="7560287978745239" type="System">
                                                    <param id="0" name="Variable">FunctionCallWaitState</param>
                                                    <param id="1" name="Value">FUNCTION_CALL_STATE_COMPLETION_PENDING</param>
                                                </action>
                                                <action id="0" name="Call function" sid="7992663441012845" type="Function">
                                                    <param id="0" name="Name">&quot;onBeforeQuestUICmdProcessing&quot;</param>
                                                    <param id="1" name="Parameter {n}">&quot;FUNC_CALL&quot;</param>
                                                </action>
                                                <action id="1" name="Set return value" sid="3240157286123055" type="Function">
                                                    <param id="0" name="Value">0</param>
                                                </action>
                                                <action id="0" name="Call function" sid="2643496411923763" type="Function">
                                                    <param id="0" name="Name">QuestLevelRuntime.getFuncName</param>
                                                    <param id="1" name="Parameter {n}"></param>
                                                </action>
                                            </actions>
                                        </event-block>
                                        <comment>Synchronous function</comment>
                                        <event-block sid="4809993689508719">
                                            <conditions>
                                                <condition id="-8" name="Compare two values" sid="6299119971107406" type="System">
                                                    <param id="0" name="First value">Function.ReturnValue</param>
                                                    <param id="1" name="Comparison">1</param>
                                                    <param id="2" name="Second value">1</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="0" name="Call function" sid="9642802482575262" type="Function">
                                                    <param id="0" name="Name">&quot;onFuncCallCompleted&quot;</param>
                                                    <param id="1" name="Parameter {n}"></param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <event-block sid="4535026817161159">
                                    <conditions>
                                        <condition id="0" name="On function" sid="865987375883442" type="Function">
                                            <param id="0" name="Name">&quot;onFuncCallCompleted&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <event-block sid="7610411744079355">
                                            <conditions>
                                                <condition id="-14" name="Compare variable" sid="865923728304684" type="System">
                                                    <param id="0" name="Variable">FunctionCallWaitState</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Value">FUNCTION_CALL_STATE_COMPLETION_PENDING</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-9" name="Set value" sid="1144661233702675" type="System">
                                                    <param id="0" name="Variable">FunctionCallWaitState</param>
                                                    <param id="1" name="Value">FUNCTION_CALL_STATE_NONE</param>
                                                </action>
                                                <action id="0" name="Call function" sid="4028931324019542" type="Function">
                                                    <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                                    <param id="1" name="Parameter {n}"></param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                            </sub-events>
                        </event-group>
                        <event-block sid="3305786164391199">
                            <conditions>
                                <condition id="7" name="onUICmdPhrase" sid="9390956600227511" type="QuestLevelRuntime" />
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="1036791496377709">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="8261344675069966" type="Function">
                                            <param id="0" name="Name">&quot;onBeforeQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}">&quot;PHRASE&quot;</param>
                                        </action>
                                        <action id="0" name="Call function" sid="2211206277646038" type="Function">
                                            <param id="0" name="Name">&quot;RunNPCPhrase&quot;</param>
                                            <param id="1" name="Parameter {n}">QuestLevelRuntime.getNPCActorUID</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block any="1" sid="3067303117300151">
                            <conditions>
                                <condition id="0" name="On function" sid="1474127909980148" type="Function">
                                    <param id="0" name="Name">&quot;onRunNPCPhraseFinished&quot;</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="4496084818162809">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="1294772801544704" type="System">
                                            <param id="0" name="Variable">CurrentUICmdName</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">&quot;PHRASE&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="8093318284004614" type="Function">
                                            <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block sid="6117926041401871">
                            <conditions>
                                <condition id="8" name="onUICmdQuizz" sid="8671113805505854" type="QuestLevelRuntime" />
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="2160604329684833">
                                    <conditions />
                                    <actions>
                                        <action id="0" name="Call function" sid="8890981784983097" type="Function">
                                            <param id="0" name="Name">&quot;onBeforeQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}">&quot;QUIZZ&quot;</param>
                                        </action>
                                        <action id="0" name="Call function" sid="338924877927862" type="Function">
                                            <param id="0" name="Name">&quot;RunNPCQuizz&quot;</param>
                                            <param id="1" name="Parameter {n}">QuestLevelRuntime.getNPCActorUID</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <event-block any="1" sid="5740919222787479">
                            <conditions>
                                <condition id="0" name="On function" sid="4991332317287468" type="Function">
                                    <param id="0" name="Name">&quot;onRunNPCQuizzFinished&quot;</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="4332167837168559">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="7666083808101859" type="System">
                                            <param id="0" name="Variable">CurrentUICmdName</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">&quot;QUIZZ&quot;</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="3115755300153945" type="Function">
                                            <param id="0" name="Name">&quot;onAfterQuestUICmdProcessing&quot;</param>
                                            <param id="1" name="Parameter {n}"></param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                    </sub-events>
                </event-group>
            </sub-events>
        </event-group>
    </events>
</c2eventsheet>
